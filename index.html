<!DOCTYPE html>
<html>
<head>
  <title>Frankenstein AI</title>
  <style type="text/css">
  html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    /*background: black;*/
    touch-action: none; 
  }
  
  img {
    display: block;
    min-height: 100%;
    min-height: 100%;
    object-fit: contain;
  }
  
  #network-config {
    position: fixed;
    background: white;
    padding: 2em;
  }
</style>
<script type="text/javascript">
  // /require {DotFilter} from '@pixi/filter-dot';
  const PIXI = require("pixi.js"),
        timeline = require("./js/timeline"),
        state = require("./js/state"),
        network = require("./js/network"),
        words = require("./js/words"),
        images = require("./js/images"),
        touch = require("./js/touch")
        
        
  
  PIXI.utils.sayHello("Frankenstein AI")
  var app, tray, sideInterface;
  
  window.onload = function() {
    // osc menu
    document.querySelector("#network-config button").onclick = function() {
      var ip = document.querySelector("input#ip").value;
      var port = parseInt(document.querySelector("input#port").value);
      network.connectOSC(ip, port);
      document.querySelector("#network-config").remove();
    }
    
    app = new PIXI.Application({ antialias: true, transparent: false });
    app.renderer.backgroundColor = 0xbabababa;
    app.renderer.autoResize = true;
    app.renderer.resize(window.innerWidth, window.innerHeight);
    document.body.appendChild(app.view);
    touch.routeMouseToTouches(app.view);
    // var renderTexture = PIXI.RenderTexture.create(window.innerWidth, window.innerHeight);
    
    tray = new PIXI.Container();
    tray.position.x = window.innerWidth/2;
    tray.position.y = window.innerHeight/2;
    tray.rotation = Math.PI/2;
    app.stage.addChild(tray);
        
    tray.addChild(words.wordPage());
    tray.addChild(images.imagePage());
    
    sideInterface = new PIXI.Container();
    sideInterface.position.x = 0;
    sideInterface.position.y = 0;
    sideInterface.rotation = Math.PI/2;
    app.stage.addChild(sideInterface);
        
    app.view.addEventListener('touchmove', function(e) {
      state.uiState.touches = e.touches;
      e.preventDefault()
      e.stopImmediatePropagation()
    });
            
    function currentState() {
      return state.logic[state.uiState.mode];
    } 
    
    function tick(d) {
      requestAnimationFrame(tick);
      const delta = d - state.uiState.lastTime;
      state.uiState.lastTime = d;
      timeline.runTimeline(delta);
      // app.renderer.render(app.stage);
      currentState().tick(delta);
    }
    
    tick(0);
  }
</script>
</head>
<body>
  <div id="network-config">
    <h1>Network Configuration</h1>
    <input placeholder="ip address" type="text" id="ip">
    <input placeholder="port" type="text" id="port">
    <button>OK</button>
  </div>
</body>
</html>